@model EventManagementSystem.Models.User

@{
    ViewData["Title"] = "User Details - " + Model.Username;
}

<div class="user-details-container">
    <div class="user-header mb-4">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h1>@Model.Username</h1>
                <p class="text-muted">@Model.FirstName @Model.LastName</p>
            </div>
            <div>
                @if (Model.IsAdmin)
                {
                    <span class="badge badge-warning badge-lg">Admin</span>
                }
                @if (Model.IsActive)
                {
                    <span class="badge badge-success badge-lg">Active</span>
                }
                else
                {
                    <span class="badge badge-danger badge-lg">Inactive</span>
                }
            </div>
        </div>
    </div>

    <div class="row">
        <!-- User Information -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-user"></i> User Information</h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4">Username:</dt>
                        <dd class="col-sm-8">@Model.Username</dd>

                        <dt class="col-sm-4">Email:</dt>
                        <dd class="col-sm-8">@Model.Email</dd>

                        <dt class="col-sm-4">First Name:</dt>
                        <dd class="col-sm-8">@Model.FirstName</dd>

                        <dt class="col-sm-4">Last Name:</dt>
                        <dd class="col-sm-8">@Model.LastName</dd>

                        <dt class="col-sm-4">Status:</dt>
                        <dd class="col-sm-8">
                            @if (Model.IsActive)
                            {
                                <span class="badge badge-success">Active</span>
                            }
                            else
                            {
                                <span class="badge badge-danger">Inactive</span>
                            }
                        </dd>

                        <dt class="col-sm-4">Role:</dt>
                        <dd class="col-sm-8">
                            @if (Model.IsAdmin)
                            {
                                <span class="badge badge-warning">Administrator</span>
                            }
                            else
                            {
                                <span class="badge badge-secondary">Regular User</span>
                            }
                        </dd>

                        <dt class="col-sm-4">Joined:</dt>
                        <dd class="col-sm-8">@Model.CreatedAt.ToString("dd MMMM yyyy HH:mm")</dd>

                        <dt class="col-sm-4">Last Updated:</dt>
                        <dd class="col-sm-8">@Model.UpdatedAt.ToString("dd MMMM yyyy HH:mm")</dd>
                    </dl>

                    <form method="post" action="@Url.Action("ToggleUserStatus", new { id = Model.Id })" class="mt-3">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn @(Model.IsActive ? "btn-warning" : "btn-success")">
                            <i class="fas fa-@(Model.IsActive ? "ban" : "check")"></i>
                            @(Model.IsActive ? "Deactivate User" : "Activate User")
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="col-md-6">
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5>Events Created</h5>
                            <h3 class="text-primary">@(Model.CreatedEvents?.Count ?? 0)</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5>RSVPs</h5>
                            <h3 class="text-info">@(Model.Rsvps?.Count ?? 0)</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5>Feedback Given</h5>
                            <h3 class="text-warning">@(Model.Feedbacks?.Count ?? 0)</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Events Created -->
    @if (Model.CreatedEvents != null && Model.CreatedEvents.Count > 0)
    {
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-calendar-alt"></i> Events Created (@Model.CreatedEvents.Count)</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Event Title</th>
                                <th>Category</th>
                                <th>Date</th>
                                <th>Attendees</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var evt in Model.CreatedEvents.OrderByDescending(e => e.CreatedAt))
                            {
                                <tr>
                                    <td>@evt.Title</td>
                                    <td>
                                        <span class="badge badge-primary">@evt.Category</span>
                                    </td>
                                    <td>@evt.StartDate.ToString("dd MMM yyyy")</td>
                                    <td>@(evt.Rsvps?.Count ?? 0)/@evt.MaxAttendees</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }

    <!-- RSVPs -->
    @if (Model.Rsvps != null && Model.Rsvps.Count > 0)
    {
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-check-circle"></i> Event RSVPs (@Model.Rsvps.Count)</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Event</th>
                                <th>Status</th>
                                <th>Guests</th>
                                <th>RSVP Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var rsvp in Model.Rsvps.OrderByDescending(r => r.RsvpDate))
                            {
                                <tr>
                                    <td>@rsvp.Event?.Title</td>
                                    <td>
                                        @if (rsvp.Status == "Attending")
                                        {
                                            <span class="badge badge-success">Attending</span>
                                        }
                                        else if (rsvp.Status == "Maybe")
                                        {
                                            <span class="badge badge-warning">Maybe</span>
                                        }
                                        else
                                        {
                                            <span class="badge badge-danger">Not Attending</span>
                                        }
                                    </td>
                                    <td>@rsvp.GuestCount</td>
                                    <td>@rsvp.RsvpDate.ToString("dd MMM yyyy")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }

    <!-- Feedbacks -->
    @if (Model.Feedbacks != null && Model.Feedbacks.Count > 0)
    {
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-comments"></i> Feedback Given (@Model.Feedbacks.Count)</h5>
            </div>
            <div class="card-body">
                <div class="feedback-list">
                    @foreach (var feedback in Model.Feedbacks.OrderByDescending(f => f.CreatedAt))
                    {
                        <div class="feedback-item">
                            <div class="d-flex justify-content-between">
                                <h6>@feedback.Event?.Title</h6>
                                <span class="badge badge-warning">@feedback.Rating <i class="fas fa-star"></i></span>
                            </div>
                            <p>@feedback.Comment</p>
                            <small class="text-muted">@feedback.CreatedAt.ToString("dd MMM yyyy")</small>
                        </div>
                    }
                </div>
            </div>
        </div>
    }

    <a href="@Url.Action("Users")" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Users
    </a>
</div>

<style>
    .user-details-container {
        padding: 20px;
    }

    .badge-lg {
        padding: 0.5rem 1rem;
        font-size: 0.95rem;
    }

    .feedback-item {
        padding: 15px;
        border-left: 3px solid #007bff;
        margin-bottom: 15px;
        background-color: #f8f9fa;
        border-radius: 4px;
    }

    .feedback-item h6 {
        margin-bottom: 10px;
    }

    .feedback-item p {
        margin-bottom: 10px;
        color: #666;
    }
</style>
