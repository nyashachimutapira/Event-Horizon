@model EventManagementSystem.Models.Event

@{
    ViewData["Title"] = "Edit Event - " + Model.Title;
}

<div class="container mt-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card shadow-lg">
                <div class="card-header bg-warning text-dark">
                    <h4 class="mb-0">Edit Event: @Model.Title</h4>
                </div>
                <div class="card-body p-4">
                    <form method="post" enctype="multipart/form-data">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@Model.Id">

                        <!-- Title -->
                        <div class="mb-3">
                            <label for="Title" class="form-label">Event Title</label>
                            <input type="text" class="form-control" 
                                   id="Title" name="Title" value="@Model.Title" required>
                            @Html.ValidationMessageFor(m => m.Title, "", new { @class = "invalid-feedback d-block" })
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label for="Description" class="form-label">Description</label>
                            <textarea class="form-control" 
                                      id="Description" name="Description" rows="4" required>@Model.Description</textarea>
                            <small class="text-muted">10-2000 characters</small>
                            @Html.ValidationMessageFor(m => m.Description, "", new { @class = "invalid-feedback d-block" })
                        </div>

                        <!-- Category -->
                        <div class="mb-3">
                            <label for="Category" class="form-label">Category</label>
                            <select class="form-select" id="Category" name="Category" required>
                                <option value="">-- Select Category --</option>
                                <option value="Conference" @(Model.Category == "Conference" ? "selected" : "")>Conference</option>
                                <option value="Workshop" @(Model.Category == "Workshop" ? "selected" : "")>Workshop</option>
                                <option value="Meetup" @(Model.Category == "Meetup" ? "selected" : "")>Meetup</option>
                                <option value="Party" @(Model.Category == "Party" ? "selected" : "")>Party</option>
                                <option value="Networking" @(Model.Category == "Networking" ? "selected" : "")>Networking</option>
                                <option value="Training" @(Model.Category == "Training" ? "selected" : "")>Training</option>
                                <option value="Other" @(Model.Category == "Other" ? "selected" : "")>Other</option>
                            </select>
                        </div>

                        <div class="row">
                            <!-- Start Date -->
                            <div class="col-md-6 mb-3">
                                <label for="StartDate" class="form-label">Start Date & Time</label>
                                <input type="datetime-local" class="form-control" 
                                       id="StartDate" name="StartDate" 
                                       value="@Model.StartDate.ToString("yyyy-MM-ddTHH:mm")" required>
                                @Html.ValidationMessageFor(m => m.StartDate, "", new { @class = "invalid-feedback d-block" })
                            </div>

                            <!-- End Date -->
                            <div class="col-md-6 mb-3">
                                <label for="EndDate" class="form-label">End Date & Time</label>
                                <input type="datetime-local" class="form-control" 
                                       id="EndDate" name="EndDate" 
                                       value="@Model.EndDate.ToString("yyyy-MM-ddTHH:mm")" required>
                                @Html.ValidationMessageFor(m => m.EndDate, "", new { @class = "invalid-feedback d-block" })
                            </div>
                        </div>

                        <!-- Location -->
                        <div class="mb-3">
                            <label for="Location" class="form-label">Location</label>
                            <input type="text" class="form-control" 
                                   id="Location" name="Location" 
                                   placeholder="City, Venue, or Virtual" 
                                   value="@Model.Location" required>
                            @Html.ValidationMessageFor(m => m.Location, "", new { @class = "invalid-feedback d-block" })
                        </div>

                        <!-- Max Attendees -->
                        <div class="mb-3">
                            <label for="MaxAttendees" class="form-label">Maximum Attendees</label>
                            <input type="number" class="form-control" 
                                   id="MaxAttendees" name="MaxAttendees" 
                                   value="@Model.MaxAttendees" min="1" max="100000" required>
                            @Html.ValidationMessageFor(m => m.MaxAttendees, "", new { @class = "invalid-feedback d-block" })
                        </div>

                        <!-- Image Upload -->
                        <div class="mb-3">
                            <label for="imageFile" class="form-label">Event Image</label>
                            <input type="file" class="form-control" 
                                   id="imageFile" name="imageFile" 
                                   accept=".jpg,.jpeg,.png,.gif">
                            <small class="text-muted">JPG, PNG, GIF (Max 5MB)</small>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.ImageUrl))
                        {
                            <div class="mb-3">
                                <img src="@Model.ImageUrl" alt="Event Image" class="img-thumbnail" style="max-width: 200px;">
                                <p class="text-muted small">Current image</p>
                            </div>
                        }

                        <!-- Status -->
                        <div class="mb-3">
                            <label for="Status" class="form-label">Status</label>
                            <select class="form-select" id="Status" name="Status" required>
                                <option value="Active" @(Model.Status == "Active" ? "selected" : "")>Active</option>
                                <option value="Cancelled" @(Model.Status == "Cancelled" ? "selected" : "")>Cancelled</option>
                                <option value="Rescheduled" @(Model.Status == "Rescheduled" ? "selected" : "")>Rescheduled</option>
                            </select>
                        </div>

                        <!-- Cancellation Reason (if cancelled) -->
                        @if (Model.Status == "Cancelled")
                        {
                            <div class="mb-3">
                                <label for="CancellationReason" class="form-label">Cancellation Reason</label>
                                <textarea class="form-control" 
                                          id="CancellationReason" name="CancellationReason" rows="2">@Model.CancellationReason</textarea>
                            </div>
                        }

                        <!-- Submit Buttons -->
                        <div class="d-grid gap-2 d-sm-flex justify-content-sm-end mb-3">
                            <a href="@Url.Action("Details", new { id = Model.Id })" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-warning">Update Event</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('Status').addEventListener('change', function() {
            const reasonDiv = document.querySelector('[id*="CancellationReason"]')?.parentElement;
            if (reasonDiv) {
                reasonDiv.style.display = this.value === 'Cancelled' ? 'block' : 'none';
            }
        });

        document.getElementById('EndDate').addEventListener('change', function() {
            const startDate = new Date(document.getElementById('StartDate').value);
            const endDate = new Date(this.value);
            
            if (endDate <= startDate) {
                this.setCustomValidity('End date must be after start date');
            } else {
                this.setCustomValidity('');
            }
        });
    </script>
}
